{"version":3,"sources":["project.js"],"names":["require","e","t","n","r","s","o","u","a","i","f","Error","code","l","exports","call","length","fkMaskJS","module","cc","_RFpush","Class","extends","Component","properties","info","fk","llk","scoreAudio","default","url","AudioClip","onLoad","this","node","on","console","width","_preCheck","preInfo","getChildByName","getComponent","type","pathIsOk","destroy","_map","loc","x","y","setVisible","path","findPath","onDestroy","_blockCount","audioEngine","playEffect","upgrate","_RFpop","pathUtil","ground","Node","fkMask","Prefab","missionLabel","Label","xSize","ySize","xSizeFk","ySizeFk","_missionNum","init","loc1","loc2","string","xMin","Math","round","xMax","yMin","yMax","fkTypeCount","fkCount","fkMaxCount","index","floor","random0To1","oneFk","instantiate","addChild","height","maskJs","_PathNode","G","H","start","end","map","marker","nodeStart","nodeEnd","toString","_getNextPath","prePath","nextNodeList","preNode","latestNode","j","distX","distY","newNode","abs","push","sort","b","result","nowListX","slice","ways","splice"],"mappings":"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","file":"project.js","sourcesContent":["require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({\"fkMaskJS\":[function(require,module,exports){\ncc._RFpush(module, '37e71Rhw+pHcah89zUWC3jZ', 'fkMaskJS');\n// llk\\fkMaskJS.js\n\n\"use strict\";\n\ncc.Class({\n    \"extends\": cc.Component,\n\n    properties: {\n        // foo: {\n        //    default: null,\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n        info: null, //obj\n        fk: null, //node\n        llk: null, //js\n        scoreAudio: {\n            \"default\": null,\n            url: cc.AudioClip\n        }\n    },\n\n    // use this for initialization\n    onLoad: function onLoad() {\n        this.node.on(\"touchend\", function () {\n            console.info(this.fk.width);\n            if (this.llk._preCheck) {\n                var preInfo = this.llk._preCheck.getChildByName(\"fkMask\").getComponent(\"fkMaskJS\").info;\n                if (preInfo.type === this.info.type && this.llk._preCheck !== this.fk && this.pathIsOk(preInfo)) {\n                    this.llk._preCheck.destroy();\n                    this.llk._preCheck = null;\n                    this.fk.destroy();\n                    this.llk._map[preInfo.loc.x][preInfo.loc.y] = 1;\n                    this.llk._map[this.info.loc.x][this.info.loc.y] = 1;\n                } else {\n                    this.llk._preCheck.getChildByName(\"fkMask\").getComponent(\"cc.Sprite\").setVisible(false);\n                    this.llk._preCheck = null;\n                }\n            } else {\n                this.fk.getChildByName(\"fkMask\").getComponent(\"cc.Sprite\").setVisible(true);\n                this.llk._preCheck = this.fk;\n            }\n        }, this);\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n\n    pathIsOk: function pathIsOk(preInfo) {\n        var path = this.llk.findPath(preInfo.loc, this.info.loc);\n        console.info(path);\n        if (path.length > 0) {\n            return true;\n        }\n        return false;\n    },\n\n    onDestroy: function onDestroy() {\n        this.llk._blockCount--;\n        cc.audioEngine.playEffect(this.scoreAudio, false);\n        if (!this.llk._blockCount) {\n            this.llk.upgrate();\n        }\n    }\n});\n\ncc._RFpop();\n},{}],\"llk\":[function(require,module,exports){\ncc._RFpush(module, '1ad6eZTdpxH+awFltRPNyuh', 'llk');\n// llk\\llk.js\n\n\"use strict\";\n\nvar pathUtil = require(\"pathUtil\");\ncc.Class({\n\t\t\t\t\"extends\": cc.Component,\n\n\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t// foo: {\n\t\t\t\t\t\t\t\t//    default: null,\n\t\t\t\t\t\t\t\t//    url: cc.Texture2D,  // optional, default is typeof default\n\t\t\t\t\t\t\t\t//    serializable: true, // optional, default is true\n\t\t\t\t\t\t\t\t//    visible: true,      // optional, default is true\n\t\t\t\t\t\t\t\t//    displayName: 'Foo', // optional\n\t\t\t\t\t\t\t\t//    readonly: false,    // optional, default is false\n\t\t\t\t\t\t\t\t// },\n\t\t\t\t\t\t\t\t// ...\n\t\t\t\t\t\t\t\tground: {\n\t\t\t\t\t\t\t\t\t\t\t\t\"default\": null,\n\t\t\t\t\t\t\t\t\t\t\t\ttype: cc.Node\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfkMask: {\n\t\t\t\t\t\t\t\t\t\t\t\t\"default\": null,\n\t\t\t\t\t\t\t\t\t\t\t\ttype: cc.Prefab\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfk: {\n\t\t\t\t\t\t\t\t\t\t\t\t\"default\": [],\n\t\t\t\t\t\t\t\t\t\t\t\ttype: [cc.Prefab]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmissionLabel: {\n\t\t\t\t\t\t\t\t\t\t\t\t\"default\": null,\n\t\t\t\t\t\t\t\t\t\t\t\ttype: cc.Label\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\txSize: 10,\n\t\t\t\t\t\t\t\tySize: 10,\n\t\t\t\t\t\t\t\txSizeFk: 50,\n\t\t\t\t\t\t\t\tySizeFk: 50,\n\t\t\t\t\t\t\t\t_preCheck: null,\n\t\t\t\t\t\t\t\t_map: [],\n\t\t\t\t\t\t\t\t_blockCount: 0,\n\t\t\t\t\t\t\t\t_missionNum: 1\n\t\t\t\t},\n\n\t\t\t\t// use this for initialization\n\t\t\t\tonLoad: function onLoad() {\n\t\t\t\t\t\t\t\tthis.init();\n\t\t\t\t},\n\n\t\t\t\t// called every frame, uncomment this function to activate update callback\n\t\t\t\t// update: function (dt) {\n\n\t\t\t\t// },\n\t\t\t\tfindPath: function findPath(loc1, loc2) {\n\t\t\t\t\t\t\t\treturn pathUtil.findPath([loc1.x, loc1.y], [loc2.x, loc2.y], this._map, 1);\n\t\t\t\t},\n\n\t\t\t\tupgrate: function upgrate() {\n\t\t\t\t\t\t\t\tif (this.xSize > this.ySize) {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.ySize++;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.xSize++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (this.xSize * this.ySize % 2 !== 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.upgrate();\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.init();\n\t\t\t\t\t\t\t\tthis._missionNum++;\n\t\t\t\t\t\t\t\tthis.missionLabel.string = \"第\" + this._missionNum + \"关\";\n\t\t\t\t},\n\n\t\t\t\tinit: function init() {\n\t\t\t\t\t\t\t\txMin = Math.round(-this.xSize / 2);\n\t\t\t\t\t\t\t\txMax = Math.round(this.xSize / 2);\n\t\t\t\t\t\t\t\tyMin = Math.round(-this.ySize / 2);\n\t\t\t\t\t\t\t\tyMax = Math.round(this.ySize / 2);\n\t\t\t\t\t\t\t\tfor (var x = yMin - 1; x < xMax + 1; x++) {\n\t\t\t\t\t\t\t\t\t\t\t\tthis._map[x] = [];\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var y = yMin - 1; y < yMax + 1; y++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis._map[x][y] = 1;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar fkTypeCount = [];\n\t\t\t\t\t\t\t\tvar fkCount = 0;\n\t\t\t\t\t\t\t\tvar fkMaxCount = this.xSize * this.ySize;\n\t\t\t\t\t\t\t\tfor (var i = 0; i < this.fk.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\tfkTypeCount[i] = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfor (var x = xMin; x < xMax; x++) {\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var y = yMin; y < yMax; y++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis._map[x][y] = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis._blockCount++;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar index = Math.floor(cc.random0To1() * this.fk.length);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (++fkCount > fkMaxCount - this.fk.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var f = 0; f < this.fk.length; f++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (fkTypeCount[f] / 2 % 1 !== 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tindex = f;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfkTypeCount[index] = fkTypeCount[index] + 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar oneFk = cc.instantiate(this.fk[index]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.ground.addChild(oneFk);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar fkMask = cc.instantiate(this.fkMask);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toneFk.addChild(fkMask);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//绑定数据和关系\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toneFk.width = this.xSizeFk;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toneFk.height = this.ySizeFk;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toneFk.x = x * this.xSizeFk;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toneFk.y = y * this.ySizeFk;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar info = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tloc: { x: x, y: y },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: index\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfkMask.width = this.xSizeFk;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfkMask.height = this.ySizeFk;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfkMask.x = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfkMask.y = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfkMask.info = info;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar maskJs = fkMask.getComponent(\"fkMaskJS\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaskJs.info = info;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaskJs.fk = oneFk;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaskJs.llk = this;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.info(oneFk.width);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n});\n\ncc._RFpop();\n},{\"pathUtil\":\"pathUtil\"}],\"pathUtil\":[function(require,module,exports){\ncc._RFpush(module, '80da7zUi9NBUoRvIyY5WrQL', 'pathUtil');\n// llk\\pathUtil.js\n\n\"use strict\";\n\nvar _PathNode = function _PathNode() {\n\tthis.x = 0;\n\tthis.y = 0;\n\tthis.G = 0; //开销\n\tthis.H = 0; //寻路优先级，越小越好\n};\n\nvar pathUtil = {\n\t//start:起始节点[i,j] ， end:最终节点[i,j]  map:地图数据(2d)arr，marker:可以通过的标识（例子用的是1）\n\tfindPath: function findPath(start, end, map, marker) {\n\t\tvar self = this;\n\t\tvar open = [];\n\t\tvar close = [];\n\n\t\tvar nodeStart = new _PathNode();\n\t\tnodeStart.x = start[0];\n\t\tnodeStart.y = start[1];\n\t\tvar nodeEnd = new _PathNode();\n\t\tnodeEnd.x = end[0];\n\t\tnodeEnd.y = end[1];\n\t\tconsole.info(start, end);\n\t\t// for(var i= )\n\t\tconsole.info(map.toString());\n\t\tconsole.info(marker);\n\t\tvar _getNextPath = function _getNextPath(prePath, nodeEnd) {\n\n\t\t\tvar nextNodeList = []; //可以当做下一个的节点\n\t\t\tvar preNode = null;\n\t\t\tif (prePath.length > 1) {\n\t\t\t\tpreNode = prePath[prePath.length - 2];\n\t\t\t}\n\t\t\tvar latestNode = prePath[prePath.length - 1];\n\t\t\tfor (var i = latestNode.x - 1; i <= latestNode.x + 1; i++) {\n\t\t\t\t//添加备选节点\n\t\t\t\tfor (var j = latestNode.y - 1; j <= latestNode.y + 1; j++) {\n\t\t\t\t\t//遍历周围八节点,排除自己\n\t\t\t\t\tif (i == latestNode.x && j == latestNode.y) continue;\n\t\t\t\t\t//排除斜着走的情况\n\t\t\t\t\tif (i !== latestNode.x && j !== latestNode.y) {\n\t\t\t\t\t\t// console.info(\"qqqq\", i, j, latestNode)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!(map[i] && map[i][j] && map[i][j] == marker) && !(i === nodeEnd.x && j === nodeEnd.y)) {\n\t\t\t\t\t\t//如果是障碍物，或在close列表中，且不是目标\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar distX = nodeEnd.x - i;\n\t\t\t\t\tvar distY = nodeEnd.y - j;\n\t\t\t\t\tvar newNode = new _PathNode();\n\t\t\t\t\tnewNode.x = i;\n\t\t\t\t\tnewNode.y = j;\n\t\t\t\t\tnewNode.H = Math.abs(distX) + Math.abs(distY);\n\t\t\t\t\tnewNode.G = latestNode.G;\n\t\t\t\t\t//判断方向，如果转折G+1\n\t\t\t\t\tif (preNode != null) {\n\t\t\t\t\t\t//console.info(newNode, latestNode, preNode, !(Math.abs(newNode.x-preNode.x)===2 || Math.abs(newNode.y-preNode.y)===2))\n\t\t\t\t\t\tif (!(Math.abs(newNode.x - preNode.x) === 2 || Math.abs(newNode.y - preNode.y) === 2)) {\n\t\t\t\t\t\t\tnewNode.G = latestNode.G + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// console.info(i,j,newNode)\n\t\t\t\t\tif (newNode.G > 2) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tnextNodeList.push(newNode);\n\n\t\t\t\t\tif (newNode.x === nodeEnd.x && newNode.y === nodeEnd.y) {\n\t\t\t\t\t\tprePath.push(newNode);\n\t\t\t\t\t\t// console.info(\"##################11111111\",prePath)\n\t\t\t\t\t\treturn prePath;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (nextNodeList.length === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tnextNodeList.sort(function (a, b) {\n\t\t\t\treturn a.H + a.G - (b.H + a.G);\n\t\t\t});\n\t\t\t// console.info(\"====\",nextNodeList)\n\n\t\t\tvar num = 1;\n\t\t\tvar result = [];\n\t\t\tvar nowListX = null;\n\t\t\tfor (var i = 0; i < nextNodeList.length && result.length <= 1; i++) {\n\t\t\t\tnowListX = prePath.slice(0);\n\t\t\t\tnowListX.push(nextNodeList[i]);\n\t\t\t\tresult = _getNextPath(nowListX, nodeEnd);\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\n\t\tvar ways = _getNextPath([nodeStart], nodeEnd);\n\t\tfor (var i = 0; i < ways.length; i++) {\n\t\t\tfor (var j = i + 1; j + 1 < ways.length; j++) {\n\t\t\t\tif (ways[i].x == ways[j].x && ways[j].x == ways[j + 1].x || ways[i].y == ways[j].y && ways[j].y == ways[j + 1].y || Math.abs(ways[i].x - ways[j].x) == Math.abs(ways[i].y - ways[j].y) && Math.abs(ways[j].x - ways[j + 1].x) == Math.abs(ways[j].y - ways[j + 1].y)) {\n\t\t\t\t\tways.splice(i + 1, 1);\n\t\t\t\t\tj--;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ways;\n\t\t// console.info(ways)\n\t}\n\n};\n\nmodule.exports = pathUtil;\n\ncc._RFpop();\n},{}]},{},[\"llk\",\"fkMaskJS\",\"pathUtil\"]);\n"],"sourceRoot":"/source/"}